<!DOCTYPE html>
<html ng-app="carringtonCalc">
<head lang="en" >
    <meta charset="UTF-8">
    <title>Carrington Calculator!</title>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

    <style>
        .col-centered {
            float: none;
            margin: 0 auto;
        }
    </style>
</head>
<body>
<div class="container">
    <div ng-controller="CalcCtrl" class="col-md-6 col-md-offset-3">
        <h1>Carrington Calculator 2.0</h1>
        <div class="form-group">
            <input type="text"
                      ng-model="rotations"
                      ng-change="carrington2date()"
                      placeholder="Carrington Rotations"
                      min="0"
                      required>
        </div>
        <div class="form-group">
            <input type="date"
                    ng-model="dateString"
                    ng-change="date2carrington()"
                    placeholder="Date String"
                    required>
        </div>
        <h1>ROTATIONS: {{rotations}}</h1>
        <h1>DATE: {{dateString | date: 'MM-dd-yyyy' }}</h1>
    </div>
</div>
</body>

<script>
    var app = angular.module('carringtonCalc', []);
    app.controller('CalcCtrl',['$scope', function($scope) {

        var CRDAYS = 27.2753;               // Carrington Rotation definition
        var SECS = 1000 * 60 * 60 *24;      // TS conversion to days
        var SDATE = "October 14, 1853";     // When CR Began
        var PRECISION = 4;                  // # of decimal places

        $scope.rotations = 0;
        $scope.dateString = new Date(SDATE);

        $scope.carrington2date = function() {
            var startDate = new Date(SDATE);
            var days = CRDAYS * $scope.rotations;
            $scope.dateString = new Date(startDate.setUTCDate(startDate.getUTCDate() + days));
            if($scope.rotations == ""){
                $scope.dateString  = startDate;
            }

        };

        $scope.date2carrington = function(){
            var startDate = new Date(SDATE);
            var days = ($scope.dateString.getTime() - startDate.getTime()) / SECS;
            var crNum = days / CRDAYS;
            $scope.rotations = crNum.toFixed(PRECISION);
        };
    }]);
</script>

</body>
</html>